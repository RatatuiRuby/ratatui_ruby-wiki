<!--
  SPDX-FileCopyrightText: 2026 Kerrick Long <me@kerricklong.com>
  SPDX-License-Identifier: CC-BY-SA-4.0
-->

> [!NOTE]
> This is an archived brainstorming document generated with an LLM. Personas and organizations mentioned are fictional. See [index.md](index.md) for context.

# **Architectural Decision Record: The "Big Tent" Ecosystem**

Date: December 30, 2025  
Status: Approved  
Scope: ratatui\_ruby ecosystem (Gem 1 through Gem 3\)

## ---

**1\. Executive Summary: The "Big Tent" Strategy**

The RatatuiRuby ecosystem will move from a linear stack to a **"Forked Path" architecture**. This strategy addresses the "Expression Problem" in TUI development by offering two distinct, mutually exclusive paradigms for application state management, both powered by the same stateless engine.

1. **Path A (High Control):** The Functional Path. Optimized for flows, state machines, and CLI tools.  
2. **Path B (High Velocity):** The Object-Oriented Path. Optimized for dashboards, platforms, and complex UI composition.

### **Ecosystem Naming & Topology**

| Layer | Gem Name | Role | Paradigm | Architecture |
| :---- | :---- | :---- | :---- | :---- |
| **L1** | ratatui\_ruby | Engine | Imperative | Stateless / Immediate Mode |
| **L2-A** | ratatui\_ruby-tea | Runtime | Functional | The Elm Architecture (TEA) |
| **L2-B** | ratatui\_ruby-components | Kit | Object-Oriented | Retained Mode Component Tree |
| **L3** | glimmer-dsl-ratatui | Syntax | Declarative | DSL Adapter |
| **L4** | ratatui\_ruby-trails | Framework | MVC | Opinionated Framework |

## ---

**2\. Layer 1: The Engine (ratatui\_ruby)**

**Current Status:** Blocking Issue Identified.

### **Architectural Decisions**

* **Thread Safety:** The engine primitives (draw, poll\_event) are not re-entrant. They must be called from the Main Thread.  
* **Event Handling:** Must support robust event mapping (Key, Mouse, and specifically Resize events) to support responsive layouts in upper layers.

### **Mandatory Changes (The "Blocker")**

To support Layer 2-A (TEA), the engine must support non-blocking execution or timeouts. The current implementation blocks indefinitely on read().

* **Rust Requirement:** Modify ext/ratatui\_ruby/src/events.rs to expose crossterm::event::poll with a timeout parameter.  
* **Ruby API:** RatatuiRuby.poll\_event(timeout: Float) (e.g., 0.05 seconds).

## ---

**3\. Layer 2-A: The Functional Runtime (ratatui\_ruby-tea)**

Codename: Gem 1.25  
Architecture: The Elm Architecture (Model-View-Update).

### **Core Architecture**

* **The Runtime:** A Program class that manages the Event Loop. It handles:  
  1. Rendering the View.  
  2. Polling Input (using the new timeout).  
  3. Checking a thread-safe Queue for Command results.  
  4. Running the Update function.  
* **Concurrency (The "Trojan Horse"):**  
  * **v1 Strategy:** Use standard Ruby Thread and Queue for stability.  
  * **v2 Prep:** Enforce **Ractor-Safety** immediately via the API. The runtime will validation that Model and Msg objects are Data or frozen, ensuring they are Ractor-shareable.  
  * **Goal:** Allow a transparent internal engine swap to Ractors in v2.0 without changing user code.  
* **API Design:**  
  * **Callable Objects:** The update and view parameters must accept any object that responds to \#call (Procs, Lambdas, or Service Objects).  
  * **No Inheritance:** We explicitly **REJECT** the "Base Class" pattern (class App \< TEA::App) to prevent users from relying on instance state.  
* **Scaling:** The documentation must emphasize **Fractal Architecture** (Composition) to prevent the "God Reducer" problem (monolithic case statements). Sub-models should have their own update logic delegated from the root.

### **Batteries Included Strategy**

* **Strict Core:** The library *will* include standard library wrappers for essential commands:  
  * Cmd.wait (Timer)  
  * Cmd.tick (Animation loops)  
  * Cmd.exec (System shell calls)  
* **Loose Peripherals (HTTP):** The library *will not* include an HTTP client to avoid dependency bloat.  
  * **Solution:** Expose a generic Cmd.call interface.  
  * **Implementation 1:** Include a Net::HTTP reference implementation in the docs/library (Zero dependency).  
  * **Implementation 2:** Publish a separate reference gem ratatui\_ruby-tea-httpx to demonstrate wrapping complex clients.

## ---

**4\. Layer 2-B & 3: Components & Glimmer**

### **ratatui\_ruby-components (Gem 1.5)**

* **Role:** The "Pro" upgrade. Solves the "God Reducer" problem via encapsulation.  
* **Structure:** Mutable component tree with a FocusManager.

### **glimmer-dsl-ratatui (Gem 2\)**

* **Naming:** Adopted the Glimmer ecosystem standard (glimmer-dsl-adapter) to ensure auto-discovery.  
* **Integration:**  
  * **Primary Target:** ratatui\_ruby-components. Supports full bidirectional data binding (\<=).  
  * **Secondary Target:** ratatui\_ruby-tea. Supports implicit view generation, but **NO** bidirectional data binding (due to TEA immutability). Documentation must be explicit about this limitation.

## ---

**5\. Product Positioning & Messaging**

To effectively sell the "Big Tent" without fragmenting the community, we will use **4 Targeted Marketing Angles**:

1. **The Junior:** *Safety vs. Speed.* TEA is a "Strict Checklist" (you can't get lost). Components are "LEGO Blocks" (fast assembly).  
2. **The Frontend Dev:** *Redux vs. React.* TEA is Redux (pure reducers). Components are React Class Components (lifecycle & state).  
3. **The Polyglot:** *Domain Fit.* Use TEA for Event-Driven Tools (CLI, Migrations). Use Components for Object-Oriented Platforms (Dashboards, IDEs).  
4. **The "Omakase" Rubyist:** *Standard Architecture.* TEA is "The Ultimate Service Object." It is the "Rails Way" for the consoleâ€”Convention over Configuration for the event loop.

## ---

**6\. Execution Plan (The "Onion Peel")**

To minimize integration risk, development will proceed in strictly defined iterative slices. We will not wait for a "Perfect Glimmer" to ship.  
**Phase 1: Foundations**

1. Implement poll\_event(timeout:) in Gem 1 (Rust). **(P0 Blocker)**.  
2. Finish "Missing 4" primitives in Gem 1\.

Phase 2: The Functional Path  
3\. Ship ratatui\_ruby-tea (Gem 1.25).  
\* Includes Program loop, Ractor-safe validation, and Std Lib Cmds.  
\* Status: "Done." No downstream dependencies.  
Phase 3: The Object Path (Iterative)  
4\. Ship ratatui\_ruby-components (Gem 1.5) Beta.  
\* Support Custom Components only (no built-ins).  
5\. Ship glimmer-dsl-ratatui (Gem 2\) Beta.  
\* Support Unidirectional binding for both TEA and Custom Components.  
6\. Update glimmer-dsl-ratatui.  
\* Add Bidirectional binding for Custom Components.  
7\. Iterative Expansion:  
\* Add one built-in Component (e.g., Button) \-\> Add Glimmer support.  
\* Add next Component \-\> Add Glimmer support.  
\* (Repeat until parity).  
---

Signed: The Technical Writer  
Verified By: CEO & CTO