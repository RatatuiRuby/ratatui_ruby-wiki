<!--
  SPDX-FileCopyrightText: 2026 Kerrick Long <me@kerricklong.com>
  SPDX-License-Identifier: CC-BY-SA-4.0
-->

> [!NOTE]
> This is an archived brainstorming document generated with an LLM. Personas and organizations mentioned are fictional. See [index.md](index.md) for context.

Based on the correspondence between the leadership team (CEO/CTO), Architect, Product Owner, Project Manager, and Application Developer, I have compiled the **Ecosystem Strategy & Architecture Decision Record (v2.0)**.  
This document serves as the authoritative source of truth for the RatatuiRuby ecosystem expansion.

# ---

**File: ECOSYSTEM\_STRATEGY\_v2.md**

## **1\. Executive Summary: "The Big Tent" Architecture**

The ratatui\_ruby project is shifting from a single stack to a **"Forked Path" Platform**. To capture both the Functional (CLI/Tool) market and the Object-Oriented (Enterprise/Dashboard) market, the ecosystem will split after Layer 1\.

* **Layer 1 (The Engine):** Shared, stateless Rust wrapper.  
* **Layer 2A (Path A):** Functional, Immutable, TEA-based runtime.  
* **Layer 2B (Path B):** Object-Oriented, Stateful, Component-based kit.

These paths are **mutually exclusive** architectures. Users choose one based on the domain complexity of their application.

## ---

**2\. Ecosystem Topology & Naming**

We adhere to standard RubyGems and Glimmer ecosystem conventions.

| Layer | Gem Name | Require Path | Role |
| :---- | :---- | :---- | :---- |
| **Engine** | ratatui\_ruby | ratatui\_ruby | The Rust Core. |
| **Path A** | ratatui\_ruby-tea | ratatui\_ruby/tea | The Elm Architecture Runtime. |
| **Path B** | ratatui\_ruby-components | ratatui\_ruby/components | Stateful Object Kit. |
| **DSL** | glimmer-dsl-ratatui | glimmer-dsl-ratatui | Declarative Syntax Adapter. |
| **Frame** | ratatui\_ruby-trails | ratatui\_ruby/trails | Full MVC Framework. |

*Note on DSL Naming:* We chose glimmer-dsl-ratatui to ensure auto-discovery within the Glimmer ecosystem. The gemspec description must explicitly state it is an "unofficial adapter."

## ---

**3\. Gem 1 (Engine) Modifications: The Critical Path**

Status: BLOCKER for Gem 1.25.  
To support the TEA runtime, the Engine must support non-blocking execution.

* **Requirement 1 (P0):** Implement poll\_event(timeout: Float).  
  * *Implementation:* Rust extension must call crossterm::event::poll before read.  
* **Requirement 2:** Reliable Resize event propagation.  
* **Requirement 3:** Thread-Safety Documentation. RatatuiRuby methods must only be called from the Main Thread.

## ---

**4\. Gem 1.25 (TEA) Architecture**

**Philosophy:** "Data in, Data out."

### **Runtime & Concurrency**

* **v1.x Strategy:** **Thread/Queue**. The runtime uses Ruby Threads to execute Commands and a thread-safe Queue to push Messages back to the main loop.  
* **v2.0 Strategy:** **Ractor**.  
* **The "Trojan Horse" Enforcement:**  
  * To prepare for v2.0, we enforce Ractor-safety rules in v1.x.  
  * The Runtime validates that all Model and Msg objects are **Shareable** (frozen/immutable).  
  * If a user passes a mutable object in a Message, the runtime errors immediately.  
  * *Decision:* We will **not** offer a configuration toggle for Ractors in v1.0. The switch will happen in v2.0/v1.9 to avoid doubling the testing surface area.

### **API Design**

* **No Base Class:** We reject class MyApp \< TEA::App.  
* **Callable Objects:** The Program accepts any object that responds to \#call (Procs, Lambdas, or Service Objects) for update and view.  
  * *Benefit:* Allows dependency injection and cleaner testing without inheritance.

### **Scaling Pattern: Fractal Architecture**

To prevent the "God Reducer" (monolithic case statements), documentation must emphasize **Fractal Architecture** (Composition) in the *Getting Started* guide.

* *Pattern:* Slice the Model (header, body) and delegate Update calls (HeaderUpdate.call(msg, model.header)).

## ---

**5\. Product Strategy**

### **Batteries Included: "Strict Core, Loose Peripherals"**

We support both the "batteries-included" CLI developer and the "opinionated" Rubyist.

1. **The Core (Built-in):** ratatui\_ruby-tea ships with standard commands using **only** the Ruby Standard Library.  
   * Cmd.wait, Cmd.tick, Cmd.exec.  
2. **The Peripherals (Plug-and-Play):** We do **not** ship an HTTP client in the core.  
   * We expose a generic Cmd.call { ... } wrapper.  
   * **Reference Implementation:** We will publish a separate repository/gem ratatui\_ruby-tea-httpx demonstrating how to wrap a robust HTTP client.

### **Marketing Messaging: The 4 Angles**

How we sell ratatui\_ruby-tea (Path A) vs. Components (Path B):

1. **The Junior:** Checklist (TEA/Safety) vs. LEGOs (Components/Speed).  
2. **The Frontend Dev:** Redux (TEA) vs. React Class Components (Components).  
3. **The Polyglot:** Event-Driven Tools (TEA) vs. Object-Oriented Platforms (Components).  
4. **The Omakase Rubyist:** "The Standard Architecture."  
   * *Pitch:* Don't invent a loop. Use a standard structure where Model is your DB-in-RAM and Update is your Controller.

## ---

**6\. Execution Roadmap (The "Onion Peel")**

We avoid a "Big Bang" release for Glimmer. We execute strictly in this order:

1. **Unblock:** Fix poll\_event in Gem 1\.  
2. **Release Path A:** Ship ratatui\_ruby-tea (v1.0).  
   * *Note:* Supports standard Ruby syntax only.  
3. **Release Path B (Beta):** Ship ratatui\_ruby-components.  
   * *Constraint:* Support **Custom Components** only (no built-in widget library yet).  
4. **Release DSL (Alpha):** Ship glimmer-dsl-ratatui.  
   * *Constraint:* Support **Unidirectional** binding only.  
   * *Scope:* Supports both TEA Views and Custom Components.  
   * *Warning:* Documentation must explicitly ban bi-directional binding (\<=) for TEA.  
5. **Iterate DSL (Beta):** Add Bidirectional binding for Components.  
6. **Iterate Ecosystem:** Sequentially release "Blessed" standard components (Button, Input) and their Glimmer adapters one by one.

## ---

**7\. Developer Experience Notes**

* **Documentation Alert:** Document the "Dead End." Users cannot migrate a TEA app to Glimmer/Components later. They must choose the path at rails new time (conceptually).  
* **Enterprise Reality:** "Enterprise" apps *can* use TEA via Fractal Architecture, but the preferred path for large teams is **Components** due to better namespace isolation and testing patterns.