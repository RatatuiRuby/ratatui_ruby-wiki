<!--
  SPDX-FileCopyrightText: 2026 Kerrick Long <me@kerricklong.com>
  SPDX-License-Identifier: CC-BY-SA-4.0
-->

> [!NOTE]
> This is an archived brainstorming document generated with an LLM. Personas and organizations mentioned are fictional. See [index.md](index.md) for context.

# **Architectural Decision Record: The RatatuiRuby Ecosystem (v2.0)**

Status: Approved / In Progress  
Date: December 30, 2025  
Context: Synthesis of strategic planning sessions regarding the future roadmap of ratatui\_ruby and its ecosystem.

## **1\. Executive Vision: "The Big Tent" (The Fork)**

The strategic direction of the ecosystem is defined as **"The Fork."** We acknowledge that TUI development requires two distinct paradigms to satisfy the market. We will not force a single architecture on all users. Instead, the ecosystem shares a common low-level engine, then splits into two mutually exclusive paths.

* **Path A (Functional / High Control):** For CLI tools, scripts, and state-machine-driven flows. Based on The Elm Architecture (TEA).  
* **Path B (Object-Oriented / High Velocity):** For complex platforms, dashboards, and "Rails-like" applications. Based on Retained Mode Components.

## **2\. Naming Conventions & Namespace Strategy**

We will adhere to strict RubyGems conventions to ensure ecosystem citizenship and technical interoperability.

| Layer | Concept | Gem Name | Require Path | Namespace | Notes |
| :---- | :---- | :---- | :---- | :---- | :---- |
| **1.0** | The Engine | ratatui\_ruby | ratatui\_ruby | RatatuiRuby | Existing. |
| **1.25** | TEA Runtime | ratatui\_ruby-tea | ratatui\_ruby/tea | RatatuiRuby::TEA | The hypen maps to module nesting. |
| **1.5** | Component Kit | ratatui\_ruby-components | ratatui\_ruby/components | RatatuiRuby::Components | The foundation for OO apps. |
| **2.0** | The DSL | glimmer-dsl-ratatui | glimmer-dsl-ratatui | Glimmer::DSL::Ratatui | Naming follows Glimmer ecosystem standards to enable auto-discovery. |
| **3.0** | The Framework | ratatui\_ruby-trails | ratatui\_ruby/trails | RatatuiRuby::Trails | "Rails for TUI." |

## ---

**3\. Layer 1: The Engine (ratatui\_ruby)**

Critical Change Required (P0 Priority):  
To support the TEA runtime (Layer 1.25), the Rust extension must support Non-Blocking Polling.

* **Current State:** RatatuiRuby.poll\_event blocks indefinitely until input is received. This freezes background threads in a TEA architecture.  
* **Required Change:** Modify ext/ratatui\_ruby/src/events.rs to expose crossterm::event::poll with a timeout parameter.  
* **New Signature:** RatatuiRuby.poll\_event(timeout: Float \= nil)  
  * nil: Blocks forever.  
  * 0.0: Returns immediately (nil if no event).  
  * \> 0: Waits for timeout seconds.  
* **Event Standardization:** Ensure Resize events are reliably returned as structured Hashes { type: :resize, width: w, height: h } to allow Views to recalculate responsive layouts.

## ---

**4\. Layer 1.25: The Functional Runtime (ratatui\_ruby-tea)**

Paradigm: The Elm Architecture (Model-View-Update).  
Target: "Many Tiny Apps," Scripts, Developer Tools.

### **A. Runtime Architecture**

* **The Loop:** A "Fast Loop" architecture.  
  1. Check Command Queue (Non-blocking).  
  2. Poll Terminal Input (Short timeout, e.g., 0.01s).  
  3. Render.  
* **Concurrency Strategy:** The "Trojan Horse."  
  * **v1.x Implementation:** Uses standard Ruby Thread and Queue for stability.  
  * **Future Proofing:** We enforce **Ractor-safety rules immediately**. The Program class will validate that Model and Msg objects are Ractor-shareable (deeply frozen/Data objects).  
  * **Goal:** In v2.0, we swap the internal engine to use Ractors without requiring user code changes.  
  * **API Design:** Use **Callable Objects**. The Program accepts any object responding to \#call for update and view. We **reject** the "Base Class" pattern (class App \< TEA::App) to prevent users from storing state in instance variables.

### **B. "Batteries Included" Strategy**

We adopt a **Strict Core, Loose Peripherals** model.

1. **Core Batteries (In-Lib):** We ship standard commands using *only* Ruby Standard Library dependencies.  
   * Cmd.wait(seconds) (Thread.sleep)  
   * Cmd.tick(interval) (Loop/Sleep)  
   * Cmd.exec(shell\_cmd) (Open3)  
   * Cmd.net\_http(url) (Net::HTTP) \- Basic GET/POST support.  
2. **Peripheral Batteries (Example/External):**  
   * We will provide a reference implementation (separate repo/gem) for a custom HTTP wrapper (e.g., ratatui\_ruby-tea-httpx).  
   * **Purpose:** To demonstrate the Cmd.call interface so Enterprise users can wrap their own security-compliant clients.

### **C. Scaling Strategy (Fractal Architecture)**

To prevent the "God Reducer" problem (monolithic case statements), documentation will emphasize **Fractal Architecture**:

* **Composition:** Breaking the Model into sub-models (HeaderModel, BodyModel).  
* **Delegation:** The main update function routes messages to sub-update callables.

## ---

**5\. Layer 2: The Syntax (glimmer-dsl-ratatui)**

**Architectural Pivot:** The Glimmer DSL will sit on top of **BOTH** sides of the fork.

### **A. Glimmer on Components (Path B)**

* **Standard Behavior:** Uses standard Glimmer bi-directional data binding.  
* **Mechanism:** Mutates the state of the underlying Component object (e.g., text \<= \[button, :text\]).

### **B. Glimmer on TEA (Path A)**

* **"Sugar for Dispatch":** Since TEA Models are immutable, Glimmer cannot mutate them directly.  
* **Mechanism:**  
  * **Read:** Reads from the Model normally.  
  * **Write:** The \<= syntax acts as a syntax sugar for **Message Dispatch**.  
  * **Convention:** It fires a standardized message (e.g., Msg::FieldUpdated.new(:field\_name, new\_value)).  
* **Requirement:** The TEA library must define and document this standard Message protocol to enable Glimmer support.

## ---

**6\. Product Strategy & Positioning**

We are positioning the ecosystem to capture four distinct developer personas. We do not denigrate either path; we align them with the problem domain.

| Persona | The Pitch | The Path |
| :---- | :---- | :---- |
| **The Junior Dev** | "Safety vs. Speed." TEA is a checklist (hard to break). Components are LEGOs (fast to build). | **Choice** |
| **The Frontend Dev** | "Redux vs. React." TEA is your Redux store. Components are your Class Components with lifecycle methods. | **Choice** |
| **The Polyglot** | "Tools vs. Platforms." Use TEA for event-driven CLI tools. Use Components for object-oriented dashboards. | **Choice** |
| **The "Omakase" Rubyist** | **"The Standard Architecture."** TEA is *Convention over Configuration* for the event loop. Model is the DB in RAM. Update is the Controller. | **Path A (TEA)** |

**Key Messaging:**

* "High Control" (TEA) vs. "High Velocity" (Components).  
* TEA is not "slow"; it is "deliberate."  
* Components are not "unsafe"; they are "pragmatic."

## ---

**7\. Execution Strategy (The Onion Peel)**

We reject a "Big Bang" release. We will ship iterative slices of functionality.  
**Priority Order:**

1. **Blocker (P0):** Fix poll\_event timeout in Rust.  
2. **Phase A:** Ship ratatui\_ruby-tea (Gem 1.25) with standard Ruby syntax (Layout.new).  
   * *Includes:* Standard Lib Cmds (HTTP, Tick, Wait).  
3. **Phase B:** Ship ratatui\_ruby-components (Gem 1.5).  
   * *Scope:* Beta. Only support *custom* components initially. No built-in widget library yet.  
4. **Phase C (The DSL):** Ship glimmer-dsl-ratatui (Gem 2).  
   * *Scope:* Beta. Supports unidirectional binding for TEA and Custom Components.  
5. **Phase D (Bi-Directional):** Update Glimmer to support bi-directional binding.  
   * *Path A:* Via Msg::FieldUpdated convention.  
   * *Path B:* Via object mutation.  
6. **Phase E (The Standard Kit):** Iteratively ship built-in Components (wrapping Ratatui widgets) and their corresponding Glimmer keywords.  
7. **Phase F (Ecosystem Expansion):** Introduce a "Bubbles-like" library of high-level pre-made components.

This strategy ensures we ship usable software at every step, allowing the "Tiny App" developers to start using TEA immediately while we build the complex machinery for the Enterprise developers.